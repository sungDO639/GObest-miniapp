<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GObest - Äáº·t dá»‹ch vá»¥ nhanh</title>
  <script src="https://zalo.me/sdk/js/miniapp/1.0.0/za.min.js"></script>
  <style>
    :root {
      --gold: #FFD700;
      --gold-light: #FFF8DC;
      --gold-dark: #DAA520;
      --white: #FFFFFF;
      --black: #333333;
      --gray: #F5F5F5;
    }
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    body {
      background-color: var(--white);
      color: var(--black);
      line-height: 1.6;
    }
    #app {
      max-width: 480px;
      margin: 0 auto;
      min-height: 100vh;
      position: relative;
      box-shadow: 0 0 15px rgba(0,0,0,0.1);
    }
    header {
      background: linear-gradient(to right, var(--gold), var(--gold-dark));
      color: var(--white);
      padding: 15px 20px;
      text-align: center;
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .logo {
      font-size: 24px;
      font-weight: bold;
      letter-spacing: 1px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .logo-icon {
      margin-right: 10px;
      font-size: 28px;
    }
    .nav {
      display: flex;
      position: fixed;
      bottom: 0;
      width: 100%;
      max-width: 480px;
      background: var(--white);
      border-top: 2px solid var(--gold);
      z-index: 90;
    }
    .nav-item {
      flex: 1;
      text-align: center;
      padding: 12px 0;
      font-size: 12px;
      color: var(--black);
      transition: all 0.3s;
      cursor: pointer;
    }
    .nav-item.active {
      color: var(--gold-dark);
      background: var(--gold-light);
      font-weight: bold;
    }
    .nav-item i {
      display: block;
      font-size: 20px;
      margin-bottom: 4px;
    }
    .page {
      display: none;
      padding: 20px;
      padding-bottom: 70px;
    }
    .page.active {
      display: block;
    }
    .card {
      background: var(--white);
      border-radius: 12px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.08);
      padding: 20px;
      margin-bottom: 20px;
      border: 1px solid rgba(218, 165, 32, 0.2);
    }
    .card-title {
      font-size: 18px;
      margin-bottom: 15px;
      color: var(--gold-dark);
      display: flex;
      align-items: center;
    }
    .card-title i {
      margin-right: 10px;
    }
    .btn {
      background: var(--gold);
      color: var(--black);
      border: none;
      padding: 14px 20px;
      border-radius: 10px;
      font-weight: bold;
      text-align: center;
      display: block;
      width: 100%;
      font-size: 16px;
      margin: 15px 0;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .btn:hover {
      background: var(--gold-dark);
      transform: translateY(-2px);
    }
    .btn-outline {
      background: transparent;
      border: 2px solid var(--gold);
      color: var(--gold-dark);
    }
    .form-group {
      margin-bottom: 20px;
    }
    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: var(--gold-dark);
    }
    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 12px 15px;
      border: 2px solid rgba(218,165,32,0.3);
      border-radius: 10px;
      background: var(--white);
      font-size: 16px;
      transition: all 0.3s;
    }
    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      border-color: var(--gold);
      outline: none;
      box-shadow: 0 0 0 3px rgba(255,215,0,0.3);
    }
    /* Message box */
    #message {
      display: none;
      background: #fff3cd;
      color: #856404;
      padding: 10px;
      border-radius: 4px;
      margin: 10px 0;
      text-align: center;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <div id="app">
    <header>
      <div class="logo">
        <span class="logo-icon">ğŸšš</span>
        <span>GObest</span>
      </div>
    </header>
    <div id="message"></div>

    <!-- Home Page -->
    <div id="homePage" class="page active">
      <div class="card">
        <div class="card-title"><i>ğŸ </i> Äáº·t dá»‹ch vá»¥ nhanh</div>
        <div class="service-card" onclick="selectService('delivery')" style="cursor:pointer; margin-bottom:12px">
          <div style="display:flex;align-items:center;">
            <span style="font-size:24px;margin-right:10px;">ğŸ“¦</span>
            <div>
              <div class="service-name">Giao hÃ ng nhanh</div>
              <div style="font-size:13px;color:#888;">Giao hÃ ng trong 30 phÃºt</div>
            </div>
          </div>
        </div>
        <div class="service-card" onclick="selectService('food')" style="cursor:pointer; margin-bottom:12px">
          <div style="display:flex;align-items:center;">
            <span style="font-size:24px;margin-right:10px;">ğŸ”</span>
            <div>
              <div class="service-name">Äá»“ Äƒn</div>
              <div style="font-size:13px;color:#888;">Giao mÃ³n báº¡n yÃªu thÃ­ch</div>
            </div>
          </div>
        </div>
        <div class="service-card" onclick="selectService('shopping')" style="cursor:pointer;">
          <div style="display:flex;align-items:center;">
            <span style="font-size:24px;margin-right:10px;">ğŸ›’</span>
            <div>
              <div class="service-name">Äi chá»£ há»™</div>
              <div style="font-size:13px;color:#888;">Mua sáº¯m tiá»‡n lá»£i</div>
            </div>
          </div>
        </div>
      </div>
      <div class="card">
        <div class="card-title"><i>ğŸ“¦</i> ÄÆ¡n hÃ ng hiá»‡n táº¡i</div>
        <div id="currentOrder">
          <p>Báº¡n chÆ°a cÃ³ Ä‘Æ¡n hÃ ng nÃ o.</p>
          <button class="btn" onclick="navigate('orderPage')">Äáº·t dá»‹ch vá»¥ ngay</button>
        </div>
      </div>
    </div>

    <!-- Order Page -->
    <div id="orderPage" class="page">
      <div class="card">
        <div class="card-title"><i>ğŸ“</i> Äáº·t dá»‹ch vá»¥</div>
        <div class="form-group">
          <label for="serviceType">Loáº¡i dá»‹ch vá»¥</label>
          <select id="serviceType">
            <option value="delivery">Giao hÃ ng nhanh</option>
            <option value="food">Äá»“ Äƒn</option>
            <option value="shopping">Äi chá»£ há»™</option>
          </select>
        </div>
        <div class="form-group">
          <label for="pickupAddress">Äá»‹a chá»‰ láº¥y hÃ ng</label>
          <input type="text" id="pickupAddress" placeholder="Nháº­p Ä‘á»‹a chá»‰ láº¥y hÃ ng">
        </div>
        <div class="form-group">
          <label for="deliveryAddress">Äá»‹a chá»‰ giao hÃ ng</label>
          <input type="text" id="deliveryAddress" placeholder="Nháº­p Ä‘á»‹a chá»‰ giao hÃ ng">
        </div>
        <div class="form-group">
          <label for="note">Ghi chÃº</label>
          <textarea id="note" rows="3" placeholder="Ghi chÃº thÃªm cho tÃ i xáº¿..."></textarea>
        </div>
        <button class="btn" onclick="placeOrder()">Äáº·t dá»‹ch vá»¥</button>
      </div>
    </div>

    <!-- Tracking Page -->
    <div id="trackPage" class="page">
      <div class="card">
        <div class="card-title"><i>ğŸ“</i> Theo dÃµi Ä‘Æ¡n hÃ ng</div>
        <div id="orderTracking"></div>
      </div>
    </div>

    <!-- Chat Page -->
    <div id="chatPage" class="page">
      <div class="card" style="padding:0;">
        <div style="padding:15px; border-bottom:1px solid #f0f0f0;">
          <strong>Chat vá»›i tÃ i xáº¿</strong>
        </div>
        <div id="chatMessages" style="height:250px; overflow-y:auto; padding:15px; background:#f5f5f5;"></div>
        <div style="display:flex; padding:10px;">
          <input type="text" id="messageInput" placeholder="Nháº­p tin nháº¯n..." style="flex:1; margin-right:10px;">
          <button class="btn" style="padding:8px 16px;" onclick="sendMessage()">Gá»­i</button>
        </div>
      </div>
    </div>

    <!-- Profile Page -->
    <div id="profilePage" class="page">
      <div class="card user-card" style="text-align:center;">
        <div style="font-size:40px; background:var(--gold); width:100px; height:100px; margin:0 auto 20px; border-radius:50%; display:flex; align-items:center; justify-content:center; color:white; font-weight:bold;">
          KH
        </div>
        <h2 id="userName">KhÃ¡ch hÃ ng</h2>
        <p id="userPhone">ÄÄƒng nháº­p Ä‘á»ƒ xem thÃ´ng tin</p>
        <button class="btn" onclick="login()">ÄÄƒng nháº­p báº±ng Zalo</button>
        <button class="btn btn-outline" onclick="logout()">ÄÄƒng xuáº¥t</button>
      </div>
    </div>

    <!-- Navigation -->
    <div class="nav">
      <div class="nav-item active" data-page="homePage" onclick="navigate('homePage')">
        <span>ğŸ </span>Trang chá»§
      </div>
      <div class="nav-item" data-page="orderPage" onclick="navigate('orderPage')">
        <span>ğŸ“</span>Äáº·t dá»‹ch vá»¥
      </div>
      <div class="nav-item" data-page="trackPage" onclick="navigate('trackPage')">
        <span>ğŸ“</span>Theo dÃµi
      </div>
      <div class="nav-item" data-page="chatPage" onclick="navigate('chatPage')">
        <span>ğŸ’¬</span>Chat
      </div>
      <div class="nav-item" data-page="profilePage" onclick="navigate('profilePage')">
        <span>ğŸ‘¤</span>CÃ¡ nhÃ¢n
      </div>
    </div>
  </div>

  <script>
    // Global variables
    let currentUser = null;
    let currentOrder = null;

    // Helper: Hiá»ƒn thá»‹ thÃ´ng bÃ¡o
    function showMessage(msg) {
      let el = document.getElementById('message');
      if (el) {
        el.textContent = msg;
        el.style.display = "block";
        setTimeout(() => { el.style.display = "none"; }, 3000);
      } else {
        alert(msg);
      }
    }

    // Helper: LÆ°u an toÃ n vÃ o localStorage
    function safeSetLocalStorage(key, value) {
      if (typeof localStorage === "undefined") {
        showMessage("TrÃ¬nh duyá»‡t khÃ´ng há»— trá»£ localStorage.");
        return false;
      }
      try {
        localStorage.setItem(key, value);
        return true;
      } catch (e) {
        showMessage("LÆ°u dá»¯ liá»‡u tháº¥t báº¡i.");
        return false;
      }
    }
    // Helper: Äá»c an toÃ n tá»« localStorage
    function safeGetLocalStorage(key) {
      if (typeof localStorage === "undefined") return null;
      try {
        return localStorage.getItem(key);
      } catch (e) {
        return null;
      }
    }

    // Helper: Äá»c user tá»« storage an toÃ n
    function getUserFromStorage() {
      let str = safeGetLocalStorage('gobest_user');
      if (!str) return null;
      try {
        return JSON.parse(str);
      } catch (e) {
        localStorage.removeItem('gobest_user');
        return null;
      }
    }
    // Helper: Äá»c order tá»« storage an toÃ n
    function getOrderFromStorage() {
      let str = safeGetLocalStorage('gobest_order');
      if (!str) return null;
      try {
        return JSON.parse(str);
      } catch (e) {
        localStorage.removeItem('gobest_order');
        return null;
      }
    }

    // Navigation
    function navigate(pageId) {
      document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
      document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
      let nav = document.querySelector(`.nav-item[data-page="${pageId}"]`);
      if (nav) nav.classList.add('active');
      let pageEl = document.getElementById(pageId);
      if (pageEl) pageEl.classList.add('active');
      // Náº¿u sang page tracking, load tracking
      if(pageId === 'trackPage') updateTracking();
      if(pageId === 'homePage') showCurrentOrder();
    }

    // Hiá»ƒn thá»‹ thÃ´ng tin user lÃªn trang cÃ¡ nhÃ¢n
    function updateUserInfo() {
      let nameEl = document.getElementById('userName');
      let phoneEl = document.getElementById('userPhone');
      if (currentUser) {
        if (nameEl) nameEl.textContent = currentUser.name;
        if (phoneEl) phoneEl.textContent = currentUser.phone || 'ChÆ°a cáº­p nháº­t';
      } else {
        if (nameEl) nameEl.textContent = 'KhÃ¡ch hÃ ng';
        if (phoneEl) phoneEl.textContent = 'ÄÄƒng nháº­p Ä‘á»ƒ xem thÃ´ng tin';
      }
    }

    // ÄÄƒng nháº­p báº±ng Zalo MiniApp (cÃ³ kiá»ƒm tra SDK)
    function login() {
      if (typeof window.za === "undefined") {
        showMessage("Chá»©c nÄƒng nÃ y chá»‰ hoáº¡t Ä‘á»™ng trong Zalo MiniApp.");
        return;
      }
      za.login(() => {
        za.getProfile(res => {
          currentUser = {
            id: res.id,
            name: res.name,
            avatar: res.avatar,
            phone: res.phone || 'ChÆ°a cáº­p nháº­t'
          };
          safeSetLocalStorage('gobest_user', JSON.stringify(currentUser));
          updateUserInfo();
          showMessage(`ChÃ o má»«ng ${res.name} Ä‘áº¿n vá»›i GObest!`);
        });
      });
    }

    // ÄÄƒng xuáº¥t
    function logout() {
      currentUser = null;
      localStorage.removeItem('gobest_user');
      updateUserInfo();
      showMessage('Báº¡n Ä‘Ã£ Ä‘Äƒng xuáº¥t!');
    }

    // Chá»n dá»‹ch vá»¥ á»Ÿ trang chá»§
    function selectService(serviceType) {
      let serviceSelect = document.getElementById('serviceType');
      if(serviceSelect) serviceSelect.value = serviceType;
      navigate('orderPage');
    }

    // Äáº·t dá»‹ch vá»¥
    function placeOrder() {
      if (!currentUser) {
        showMessage("Vui lÃ²ng Ä‘Äƒng nháº­p Ä‘á»ƒ Ä‘áº·t dá»‹ch vá»¥!");
        navigate('profilePage');
        return;
      }
      let serviceType = document.getElementById('serviceType') ? document.getElementById('serviceType').value : '';
      let pickupAddress = document.getElementById('pickupAddress') ? document.getElementById('pickupAddress').value : '';
      let deliveryAddress = document.getElementById('deliveryAddress') ? document.getElementById('deliveryAddress').value : '';
      let note = document.getElementById('note') ? document.getElementById('note').value : '';
      if (!pickupAddress || !deliveryAddress) {
        showMessage("Vui lÃ²ng nháº­p Ä‘áº§y Ä‘á»§ Ä‘á»‹a chá»‰!");
        return;
      }
      currentOrder = {
        id: 'GOBEST' + Math.floor(100000 + Math.random() * 900000),
        serviceType,
        pickupAddress,
        deliveryAddress,
        note,
        status: 'Äang tÃ¬m tÃ i xáº¿',
        date: new Date().toLocaleString()
      };
      safeSetLocalStorage('gobest_order', JSON.stringify(currentOrder));
      showMessage(`ÄÆ¡n hÃ ng #${currentOrder.id} Ä‘Ã£ Ä‘Æ°á»£c táº¡o thÃ nh cÃ´ng!`);
      showCurrentOrder();
      navigate('trackPage');
    }

    // Hiá»ƒn thá»‹ Ä‘Æ¡n hÃ ng hiá»‡n táº¡i á»Ÿ trang chá»§
    function showCurrentOrder() {
      let order = getOrderFromStorage();
      let el = document.getElementById('currentOrder');
      if (!el) return;
      if (!order) {
        el.innerHTML = `<p>Báº¡n chÆ°a cÃ³ Ä‘Æ¡n hÃ ng nÃ o.</p>
          <button class="btn" onclick="navigate('orderPage')">Äáº·t dá»‹ch vá»¥ ngay</button>`;
        return;
      }
      el.innerHTML = `
        <div class="card-title"><i>ğŸ“¦</i> ÄÆ¡n hÃ ng #${order.id}</div>
        <p><b>Dá»‹ch vá»¥:</b> ${getServiceName(order.serviceType)}</p>
        <p><b>Láº¥y hÃ ng:</b> ${order.pickupAddress}</p>
        <p><b>Giao tá»›i:</b> ${order.deliveryAddress}</p>
        <p><b>Tráº¡ng thÃ¡i:</b> ${order.status}</p>
        <button class="btn" onclick="navigate('trackPage')">Theo dÃµi Ä‘Æ¡n hÃ ng</button>
        <button class="btn btn-outline" onclick="cancelOrder()">Há»§y Ä‘Æ¡n hÃ ng</button>
      `;
    }

    // Há»§y Ä‘Æ¡n hÃ ng
    function cancelOrder() {
      if (confirm('Báº¡n cÃ³ cháº¯c cháº¯n muá»‘n há»§y Ä‘Æ¡n hÃ ng nÃ y?')) {
        localStorage.removeItem('gobest_order');
        currentOrder = null;
        showCurrentOrder();
        showMessage('ÄÆ¡n hÃ ng Ä‘Ã£ Ä‘Æ°á»£c há»§y.');
        navigate('homePage');
      }
    }

    // Theo dÃµi Ä‘Æ¡n hÃ ng
    function updateTracking() {
      let order = getOrderFromStorage();
      let el = document.getElementById('orderTracking');
      if (!el) return;
      if (!order) {
        el.innerHTML = '<p>Báº¡n chÆ°a cÃ³ Ä‘Æ¡n hÃ ng nÃ o Ä‘á»ƒ theo dÃµi.</p>';
        return;
      }
      el.innerHTML = `
        <div><b>MÃ£ Ä‘Æ¡n:</b> #${order.id}</div>
        <div><b>Tráº¡ng thÃ¡i:</b> ${order.status}</div>
        <div><b>Dá»‹ch vá»¥:</b> ${getServiceName(order.serviceType)}</div>
        <div><b>Láº¥y hÃ ng:</b> ${order.pickupAddress}</div>
        <div><b>Giao tá»›i:</b> ${order.deliveryAddress}</div>
        <div><b>Thá»i gian:</b> ${order.date}</div>
        <button class="btn" onclick="navigate('chatPage')">Chat vá»›i tÃ i xáº¿</button>
        <button class="btn btn-outline" onclick="cancelOrder()">Há»§y Ä‘Æ¡n hÃ ng</button>
      `;
    }

    // Gá»­i tin nháº¯n chat (giáº£ láº­p)
    function sendMessage() {
      let input = document.getElementById('messageInput');
      let chatMessages = document.getElementById('chatMessages');
      if (!input || !chatMessages) return;
      let message = input.value.trim();
      if (!message) return;
      let msgDiv = document.createElement('div');
      msgDiv.style = 'text-align:right; margin-bottom:8px; color:#333;';
      msgDiv.textContent = message;
      chatMessages.appendChild(msgDiv);
      input.value = '';
      setTimeout(() => {
        let replyDiv = document.createElement('div');
        replyDiv.style = 'text-align:left; margin-bottom:8px; color:#666;';
        replyDiv.textContent = "TÃ i xáº¿ sáº½ liÃªn há»‡ vá»›i báº¡n sá»›m!";
        chatMessages.appendChild(replyDiv);
        chatMessages.scrollTop = chatMessages.scrollHeight;
      }, 900);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    // TÃªn dá»‹ch vá»¥ tiáº¿ng Viá»‡t
    function getServiceName(type) {
      switch(type) {
        case 'delivery': return 'Giao hÃ ng nhanh';
        case 'food': return 'Äá»“ Äƒn';
        case 'shopping': return 'Äi chá»£ há»™';
        default: return 'Dá»‹ch vá»¥';
      }
    }

    // Khá»Ÿi Ä‘á»™ng
    document.addEventListener('DOMContentLoaded', function() {
      // Load user vÃ  order tá»« storage
      currentUser = getUserFromStorage();
      currentOrder = getOrderFromStorage();
      updateUserInfo();
      showCurrentOrder();
    });
  </script>
</body>
</html>
